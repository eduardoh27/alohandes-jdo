--- Sentencias SQL para la creación del esquema de alohandes

-- Creación del secuenciador
create sequence alohandes_sequence START WITH 13;

-- Creación de la TABLA TIPOMIEMEBROCOMUNIDAD y especificación de sus restricciones

CREATE TABLE TIPOMIEMBROCOMUNIDAD
   (ID NUMBER, 
	NOMBRE VARCHAR2(255 BYTE) NOT NULL, 
	CONSTRAINT TIPOMIEMBROCOMUNIDAD_PK PRIMARY KEY (ID));

ALTER TABLE TIPOMIEMBROCOMUNIDAD
	ADD CONSTRAINT CK_NOMBRE_TIPOMIEMBROCOMUNIDAD 
	CHECK (NOMBRE IN ('Profesor', 'Empleado',
    'Egresado','Estudiante','padreEstudiante'))
ENABLE;


ALTER TABLE TIPOMIEMBROCOMUNIDAD
ADD CONSTRAINT UN_TIPO_TIPOMIEMBROCOMUNIDAD
    UNIQUE (NOMBRE)
ENABLE;


-- Creación de la TABLA CLIENTE y especificación de sus restricciones
CREATE TABLE CLIENTE
   (CEDULA NUMBER, 
	CORREO VARCHAR2(255 BYTE), 
	NOMBRE VARCHAR2(50 BYTE), 
	CELULAR NUMERIC(10) NOT NULL,
    VINCULACION NUMBER,
    CLAVE VARCHAR2(50 BYTE) NOT NULL,
	CONSTRAINT CLIENTE_PK PRIMARY KEY (CEDULA));

ALTER TABLE CLIENTE
ADD CONSTRAINT FK_A_TIPOMIEMBROCOMUNIDAD
    FOREIGN KEY (VINCULACION)
    REFERENCES TIPOMIEMBROCOMUNIDAD(ID)
ENABLE;


ALTER TABLE CLIENTE
ADD CONSTRAINT UN_TIPOCEL_CLIENTE
    UNIQUE (CELULAR)
ENABLE;


-- Creación de la TABLA OPERADOR y especificación de sus restricciones

CREATE TABLE OPERADOR
   (ID NUMBER, 
	INGRESOPORANIOACTUAL NUMBER, 
	INGRESOPORANIOCORRIDO NUMBER, 
	NOMBRE VARCHAR2(50 BYTE) NOT NULL,
    	CLAVE VARCHAR2(50 BYTE) NOT NULL,
	CORREO VARCHAR2(255 BYTE) NOT NULL,
	CONSTRAINT OPERADOR_PK PRIMARY KEY (ID));
    
ALTER TABLE OPERADOR
	ADD CONSTRAINT CK_INGRESOPORANIOACTUAL_OPERADOR
	CHECK (INGRESOPORANIOACTUAL >=0)
ENABLE;

ALTER TABLE OPERADOR
	ADD CONSTRAINT CK_INGRESOPORANIOCORRIDO_OPERADOR
	CHECK (INGRESOPORANIOCORRIDO >=0)
ENABLE;

-- Creación de la TABLA TIPOOPERADOREMPRESA y especificación de sus restricciones
CREATE TABLE TIPOOPERADOREMPRESA
   (ID NUMBER, 
	NOMBRE VARCHAR2(255 BYTE) NOT NULL, 
	CONSTRAINT TIPOOPERADOREMPRESA_PK PRIMARY KEY (ID));

ALTER TABLE TIPOOPERADOREMPRESA
	ADD CONSTRAINT CK_NOMBRE_TIPOOPERADOREMPRESA 
	CHECK (NOMBRE IN ('Hotel', 'Hostal',
    'ViviendaUniversitaria'))
ENABLE;

ALTER TABLE TIPOOPERADOREMPRESA
ADD CONSTRAINT UN_TIPO_TIPOOPERADOREMPRESA
    UNIQUE (NOMBRE)
ENABLE;


-- Creación de la TABLA EMPRESA y especificación de sus restricciones
CREATE TABLE EMPRESA
   (NIT NUMBER, 
	UBICACION VARCHAR2(255 BYTE) NOT NULL, 
	RECEPCION NUMBER NOT NULL, 
	REGISTROTURISMO NUMERIC(9) NOT NULL,
    REGISTROCAMARA NUMERIC(9)NOT NULL,
    NUMEROCONTACTO NUMERIC(10) NOT NULL,
    TIPO NUMBER NOT NULL,
	CONSTRAINT EMPRESA_PK PRIMARY KEY (NIT));

ALTER TABLE EMPRESA
ADD CONSTRAINT FK_A_OPERADOR
    FOREIGN KEY (NIT)
    REFERENCES OPERADOR(ID)
ENABLE;

ALTER TABLE EMPRESA
ADD CONSTRAINT FK_A_TIPOOPERADOREMPRESA
    FOREIGN KEY (TIPO)
    REFERENCES TIPOOPERADOREMPRESA(ID)
ENABLE;

ALTER TABLE EMPRESA
ADD CONSTRAINT CK_UNOCERO_RECEPCION_EMPRESA
    CHECK (RECEPCION IN (0,1))
ENABLE;

-- Creación de la TABLA TIPOOPERADORNATURAL y especificación de sus restricciones
CREATE TABLE TIPOOPERADORNATURAL
   (ID NUMBER, 
	NOMBRE VARCHAR2(255 BYTE) NOT NULL, 
	CONSTRAINT TIPOOPERADORNATURAL_PK PRIMARY KEY (ID));

ALTER TABLE TIPOOPERADORNATURAL
	ADD CONSTRAINT CK_NOMBRE_TIPOOPERADORNATURAL
	CHECK (NOMBRE IN ('Vecino', 'PersonaNatural',
    'miembroComunidad'))
ENABLE;

ALTER TABLE TIPOOPERADORNATURAL
ADD CONSTRAINT UN_TIPO_TIPOOPERADORNATURAL
    UNIQUE (NOMBRE)
ENABLE;


-- Creación de la TABLA PERSONANATURAL y especificación de sus restricciones
CREATE TABLE PERSONANATURAL
   (CEDULA NUMBER,  
	CELULAR NUMERIC(10) NOT NULL,
    TIPO NUMBER NOT NULL,
	CONSTRAINT PERSONANATURAL_PK PRIMARY KEY (CEDULA));

ALTER TABLE PERSONANATURAL
ADD CONSTRAINT FK_PN_A_OPERADOR
    FOREIGN KEY (CEDULA)
    REFERENCES OPERADOR(ID)
ENABLE;

ALTER TABLE PERSONANATURAL
ADD CONSTRAINT FK_A_TIPOOPERADORNATURAL
    FOREIGN KEY (TIPO)
    REFERENCES TIPOOPERADORNATURAL(ID)
ENABLE;

-- Creación de la TABLA CONTRATO y especificación de sus restricciones

CREATE TABLE CONTRATO
   (ID NUMBER, 
	INTERNET NUMBER NOT NULL,
    ADMINISTRACION NUMBER NOT NULL,
    SERVICIOSPUBLICOS NUMBER NOT NULL,
    TV NUMBER NOT NULL,
	CONSTRAINT CONTRATO_PK PRIMARY KEY (ID));

ALTER TABLE CONTRATO
ADD CONSTRAINT CK_UNOCERO_SERVICIOSPUBLICOS_CONTRATO
    CHECK (SERVICIOSPUBLICOS IN (0,1))
ENABLE;

ALTER TABLE CONTRATO
ADD CONSTRAINT CK_UNOCERO_TV_CONTRATO
    CHECK (TV IN (0,1))
ENABLE;

ALTER TABLE CONTRATO
ADD CONSTRAINT CK_UNOCERO_INTERNET_CONTRATO
    CHECK (INTERNET IN (0,1))
ENABLE;

ALTER TABLE CONTRATO
ADD CONSTRAINT CK_UNOCERO_ADMINISTRACION_CONTRATO
    CHECK (ADMINISTRACION IN (0,1))
ENABLE;


-- 9. Seguro

CREATE TABLE SEGURO
   (ID NUMBER, 
	NOMBREEMPRESA VARCHAR2(255 BYTE),
    MODALIDAD VARCHAR2(255 BYTE),
    CODEUDOR NUMBER NOT NULL,
    VALORARRIENDO NUMBER NOT NULL,
    DURACION NUMBER,
	CONSTRAINT SEGURO_PK PRIMARY KEY (ID));

ALTER TABLE SEGURO
	ADD CONSTRAINT CK_MODALIDAD_SEGURO
        CHECK (MODALIDAD IN ('presencial', 'digital'))
ENABLE;

ALTER TABLE SEGURO
	ADD CONSTRAINT CK_CODEUDOR_SEGURO
        CHECK (CODEUDOR IN (0, 1))
ENABLE;

ALTER TABLE SEGURO
	ADD CONSTRAINT CK_DURACION_SEGURO
        CHECK (DURACION IN (3, 6, 12))
ENABLE;



-- 10. Horario

CREATE TABLE HORARIO
   (ID NUMBER, 
    HORAAPERTURA DATE NOT NULL,
    HORACIERRE DATE NOT NULL,
	CONSTRAINT HORARIO_PK PRIMARY KEY (ID));



-- 11. TipoAlojamiento

CREATE TABLE TIPOALOJAMIENTO
   (ID NUMBER,
    NOMBRE VARCHAR2(255 BYTE),
    TIPOPAGO  VARCHAR2(255 BYTE),
	CONSTRAINT TIPOALOJAMIENTO_PK PRIMARY KEY(ID));

ALTER TABLE TIPOALOJAMIENTO
	ADD CONSTRAINT CK_NOMBRE_TIPOALOJAMIENTO
        CHECK (NOMBRE IN ('habitacionHotel', 
            'habitacionHostal', 'habitacionVivienda', 
            'apartamento', 'vivienda', 'habitacionResidencia'))
ENABLE;


ALTER TABLE TIPOALOJAMIENTO
	ADD CONSTRAINT CK_TIPOPAGO_TIPOALOJAMIENTO
        CHECK (TIPOPAGO IN ('mes', 'dia'))
ENABLE;


ALTER TABLE TIPOALOJAMIENTO
ADD CONSTRAINT UN_TIPO_TIPOALOJAMIENTO
    UNIQUE (NOMBRE)
ENABLE;


-- 12. Alojamiento

CREATE TABLE ALOJAMIENTO
   (ID NUMBER,
    NUMHABITACIONES NUMBER NOT NULL,
    UBICACION VARCHAR2(255 BYTE) NOT NULL,
    PRECIO NUMBER NOT NULL,
    AMOBLADO NUMBER NOT NULL,
    CAPACIDAD NUMBER NOT NULL,
    COMPARTIDO NUMBER NOT NULL,
    INDICEOCUPACION NUMBER NOT NULL,
    TIPO NUMBER NOT NULL,
    HORARIO NUMBER,
    SEGURO NUMBER,
    OPERADOR NUMBER NOT NULL,
    ACTIVO NUMBER NOT NULL,
	CONSTRAINT ALOJAMIENTO_PK PRIMARY KEY (ID));

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_NUMHABITACIONES_ALOJAMIENTO
        CHECK (NUMHABITACIONES > 0)
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_PRECIO_ALOJAMIENTO
        CHECK (PRECIO > 0)
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_AMOBLADO_ALOJAMIENTO
        CHECK (AMOBLADO IN (0, 1))
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_CAPACIDAD_ALOJAMIENTO
        CHECK (CAPACIDAD > 0)
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_COMPARTIDO_ALOJAMIENTO
        CHECK (COMPARTIDO IN (0,1))
ENABLE;

ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT FK_TIPO_ALOJAMIENTO
    FOREIGN KEY (TIPO)
    REFERENCES TIPOALOJAMIENTO(ID)
ENABLE;

ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT FK_HORARIO_ALOJAMIENTO
    FOREIGN KEY (HORARIO)
    REFERENCES HORARIO(ID)
ENABLE;

ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT FK_SEGURO_ALOJAMIENTO
    FOREIGN KEY (SEGURO)
    REFERENCES SEGURO(ID)
ENABLE;

ALTER TABLE ALOJAMIENTO
ADD CONSTRAINT FK_OPERADOR_ALOJAMIENTO
    FOREIGN KEY (OPERADOR)
    REFERENCES OPERADOR(ID)
ENABLE;

ALTER TABLE ALOJAMIENTO
	ADD CONSTRAINT CK_ACTIVO_ALOJAMIENTO
        CHECK (ACTIVO IN (0, 1))
ENABLE;

-- 13. Reserva

CREATE TABLE RESERVA
   (ID NUMBER,
    FECHACANCELACION DATE,
    FECHAINICIO DATE NOT NULL,
    FECHAFINAL DATE NOT NULL,
    ALOJAMIENTO NUMBER,
    CLIENTE NUMBER NOT NULL,
    CONTRATO NUMBER,
    PRECIO NUMBER NOT NULL,
    CANTIDADPERSONAS NUMBER NOT NULL,
    RESERVAMADRE NUMBER,
	CONSTRAINT RESERVA_PK PRIMARY KEY (ID));

-- En contrato, fechainicio sin not null y fechafinal con not null
ALTER TABLE RESERVA
ADD CONSTRAINT FK_ALOJAMIENTO_RESERVA
    FOREIGN KEY (ALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;
    
ALTER TABLE RESERVA
ADD CONSTRAINT FK_CLIENTE_RESERVA
    FOREIGN KEY (CLIENTE)
    REFERENCES CLIENTE(CEDULA)
ENABLE;

ALTER TABLE RESERVA
ADD CONSTRAINT FK_CONTRATO_RESERVA
    FOREIGN KEY (CONTRATO)
    REFERENCES CONTRATO(ID)
ENABLE;

ALTER TABLE RESERVA
ADD CONSTRAINT CK_MENOR_FECHAINICIOFINAL_RESERVA
    CHECK (FECHAINICIO < FECHAFINAL)
ENABLE;

ALTER TABLE RESERVA
ADD CONSTRAINT CK_MAYORCERO_PRECIO_RESERVA
    CHECK (PRECIO>=0)
ENABLE;

-- 14. TipoServicioPublico

CREATE TABLE TIPOSERVICIOPUBLICO
   (ID NUMBER,
    NOMBRE VARCHAR2(255 BYTE),
	CONSTRAINT TIPOSERVICIOPUBLICO_PK PRIMARY KEY (ID));

ALTER TABLE TIPOSERVICIOPUBLICO
	ADD CONSTRAINT CK_NOMBRE_TIPOSERVICIOPUBLICO
        CHECK (NOMBRE IN ('agua', 
            'luz', 'telefono', 
            'tvCable', 'internet'))
ENABLE;

ALTER TABLE TIPOSERVICIOPUBLICO
ADD CONSTRAINT UN_TIPO_TIPOSERVICIOPUBLICO
    UNIQUE (NOMBRE)
ENABLE;


-- 15. ServicioPublico

CREATE TABLE SERVICIOPUBLICO
   (ID NUMBER,
    COSTO NUMBER NOT NULL,
    TIPO NUMBER,
    ALOJAMIENTO NUMBER,
	CONSTRAINT SERVICIOPUBLICO_PK PRIMARY KEY (ID));
    
ALTER TABLE SERVICIOPUBLICO
ADD CONSTRAINT FK_TIPO_SERVICIOPUBLICO
    FOREIGN KEY (TIPO)
    REFERENCES TIPOSERVICIOPUBLICO(ID)
ENABLE;

ALTER TABLE SERVICIOPUBLICO
ADD CONSTRAINT FK_ALOJAMIENTO_SERVICIOPUBLICO
    FOREIGN KEY (ALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;



-- 16. TipoServicio

CREATE TABLE TIPOSERVICIO
   (ID NUMBER,
    NOMBRE VARCHAR2(255 BYTE),
	CONSTRAINT TIPOSERVICIO_PK PRIMARY KEY (ID));

ALTER TABLE TIPOSERVICIO
	ADD CONSTRAINT CK_NOMBRE_TIPOSERVICIO
        CHECK (NOMBRE IN ('restaurante', 
            'piscina', 'parqueadero', 
            'wifi', 'recepcion',
            'comida', 'accesoCocina',
            'banioPrivado', 'banioCompartido',
            'habitacionIndividual', 'habitacionCompartida',
            'baniera', 'yacuzzi', 
            'sala', 'cocineta',
            'servicioRestaurante', 'salaEstudio',
            'salaEsparcimiento', 'gimnasio'))
ENABLE;


ALTER TABLE TIPOSERVICIO
ADD CONSTRAINT UN_TIPO_TIPOSERVICIO
    UNIQUE (NOMBRE)
ENABLE;


-- 17. Servicio

CREATE TABLE SERVICIO
   (ID NUMBER,
    TIPO NUMBER,
    ALOJAMIENTO NUMBER,
	CONSTRAINT SERVICIO_PK PRIMARY KEY (ID));
    
ALTER TABLE SERVICIO
ADD CONSTRAINT FK_TIPO_SERVICIO
    FOREIGN KEY (TIPO)
    REFERENCES TIPOSERVICIO(ID)
ENABLE;

ALTER TABLE SERVICIO
ADD CONSTRAINT FK_ALOJAMIENTO_SERVICIO
    FOREIGN KEY (ALOJAMIENTO)
    REFERENCES ALOJAMIENTO(ID)
ENABLE;


COMMIT;
